
@{
    ViewBag.Title = "Hồ sơ chờ tiếp nhận";
    Layout = "~/Views/Shared/_AdminMasterPage.cshtml";
}

<link href="~/CustomCSS/Document/DocumentNotReceived.css" rel="stylesheet" />
<link rel="stylesheet" href="~/CustomCSS/InvitationCard/ConfirmInforBonus.css" />
<link rel="stylesheet" href="~/CustomCSS/preloader/ConfirmInfor.css" />
<link rel="stylesheet" href="~/CustomCSS/Document/DocumentReceived.css" />
<link href="~/assets/Custom css/TABLE_BORDERED.css" rel="stylesheet" />
<link href="~/CustomJS/datepicker_src/dist/css/datepicker.min.css" rel="stylesheet" />
<link href="~/CustomJS/datepicker_src/dist/css/custom.css" rel="stylesheet" />
<link href="~/CustomJS/datepicker_src/dist/css/font.css" rel="stylesheet" />

<link href="~/dist/css/pages/data-table.css" rel="stylesheet">


<div class="page-titles">
    <div class="d-flex align-items-center">
        <h4 class="font-medium m-b-0 pdleft black-text">Danh sách giấy hẹn - Chờ tiếp nhận</h4>
    </div>
</div>

<div class="container-fluid">
    <div class="row">
        <div class="col s12">
            <div class="card p-b-10">
                <div class="form-body">
                    <div class="divider"></div>
                    <div class="card-content">
                        <div class="row">
                            <div class="col s12 l6">
                                <div class="row">
                                    <div class="col s3">
                                        <div class="h-form-label margintop">
                                            <label for="f-name" class="text-black">Tỉnh/thành</label>
                                        </div>
                                    </div>
                                    <div class="col s8">
                                        <div class="h-form-label">
                                            <select tabindex="-1" class="card-border" id="province">
                                                <option value="">Tất cả</option>
                                                @foreach (vnpost_ocr_system.Models.Province item in ViewBag.proList)
                                                {
                                                    <option value="@item.PostalProvinceCode">@item.PostalProvinceName</option>
                                                }

                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col s12 l6">
                                <div class="row">
                                    <div class="col s3">
                                        <div class="h-form-label margintop">
                                            <label for="l-name" class="text-black">Tên thủ tục</label>
                                        </div>
                                    </div>
                                    <div class="col s9">
                                        <div class="h-form-label">
                                            <select tabindex="-1" class="card-border" style="width:100%!important;" id="profile">
                                                <option value="">Tất cả</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="row">
                            <div class="col s12 l6">
                                <div class="row">
                                    <div class="col s3">
                                        <div class="h-form-label margintop">
                                            <label for="l-name" class="text-black">Quận/huyện</label>
                                        </div>
                                    </div>
                                    <div class="col s8">
                                        <div class="h-form-label">
                                            <select tabindex="-1" class="card-border" id="district">
                                                <option value="">Tất cả</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col s12 l6">
                                <div class="row">
                                    <div class="col s3">
                                        <div class="h-form-label margintop">
                                            <label for="f-name" class="text-black">Từ ngày</label>
                                        </div>
                                    </div>
                                    <div class="col s9">
                                        <div class="h-form-label">
                                            <div class="col l11 s10 p-l-0">
                                                <input name="dateTLHD" id="dateFrom" type="text" readonly
                                                       class="datepicker-here" autocomplete="off"
                                                       data-language='vi' value="" placeholder="Từ ngày" style="width: 100%!important;" />
                                            </div>
                                            <div class="col l1 s2 p-l-0">
                                                <img class="cal-img p-t-5" src="~/Content/BankLogo/calendar.jpg" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="row">
                            <div class="col s12 l6">
                                <div class="row">
                                    <div class="col s3">
                                        <div class="h-form-label margintop">
                                            <label for="l-name" class="text-black">Cơ quan hành chính</label>
                                        </div>
                                    </div>
                                    <div class="col s8">
                                        <div class="h-form-label">
                                            <select tabindex="-1" class="card-border" id="coQuan">
                                                <option value='' selected>Tất cả</option>
                                            </select>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col s12 l6">
                                <div class="row">
                                    <div class="col s3">
                                        <div class="h-form-label margintop">
                                            <label for="f-name" class="text-black">Đến ngày</label>
                                        </div>
                                    </div>
                                    <div class="col s9">
                                        <div class="h-form-label">
                                            <div class="col l11 s10 p-l-0">
                                                <input name="dateTLHD" id="dateTo" type="text" readonly
                                                       class="datepicker-here" autocomplete="off"
                                                       data-language='vi' value="" placeholder="Đến ngày" style="width: 100%!important;" />
                                            </div>
                                            <div class="col l1 s2 p-l-0">
                                                <img class="cal-img p-t-5" src="~/Content/BankLogo/calendar.jpg" />
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="card-content">
                        <div class="row">
                            <div class="col s12 l6">
                                <div class="row">
                                    <div class="col s3">
                                    </div>
                                    <div class="col s8">
                                    </div>
                                </div>
                            </div>
                            <div class="col s12 l6">
                                <div class="row">
                                    <div class="col s3">
                                        <div class="h-form-label margintop">
                                            <label for="l-name" class="text-black"></label>
                                        </div>
                                    </div>
                                    <div class="col s9">
                                        <div class="h-form-label right-align">
                                            <button class="btn waves-effect waves-light bt-color-common my-bt" id="filter">
                                                <div class="m-0-0 p-0-0 d-flex">
                                                    <i class="material-icons my-icon">filter_list</i>
                                                    <span class="bt-inner-text">Hiển thị</span>
                                                </div>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="row m-t-10 m-b-10">
        <div class="col s12">
            <div class="right-align">
                <button class="btn waves-effect waves-light bt-color-common my-bt" type="submit">
                    <div class="m-0-0 p-0-0 d-flex">
                        <i class="material-icons my-icon">local_printshop</i>
                        <span class="bt-inner-text">In</span>
                    </div>
                </button>
                <button class="btn waves-effect waves-light bt-color-common my-bt" type="submit">
                    <div class="m-0-0 p-0-0 d-flex">
                        <i class="material-icons my-icon">grid_on</i>
                        <span class="bt-inner-text">Kết xuất excel</span>
                    </div>
                </button>
            </div>
        </div>
    </div>
    <div class="row">
        <div class="col s12">
            <div class="card">
                <div class="card-content">
                    <div class="table-responsive m-b-40 m-t-30">
                        <table id="mainTable" class="table-bordered table-responsive">
                            <thead>
                                <tr>
                                    <th class="width-20 table-width">Mã hồ sơ</th>
                                    <th class="width-11 table-width">Tỉnh thành</th>
                                    <th class="width-13 table-width">Cơ quan HCC</th>
                                    <th class="width-13 table-width">Tên thủ tục</th>
                                    <th class="width-10 table-width">Ngày gửi</th>
                                    <th class="width-13 table-width">Người nhận</th>
                                    <th class="width-22 table-width">Địa chỉ người nhận</th>
                                    <th class=""></th>
                                </tr>
                            </thead>
                            <tbody>
                            </tbody>
                        </table>

                        <input style="position: absolute; top: 240px; left: 885px; padding: 15px 5px; text-align: left; font: 400 15px/22.5px &quot;Nunito Sans&quot;, sans-serif; border: 0px none rgb(144, 152, 172); width: 384px; height: 22px; display: none;">
                    </div>
                    @*<div class="no-collapse-m-p">
                            <ul class="pagination m-t-15 center-align">
                                <li class="pagination_button page-item previous disabled" id="zero_config_previous">
                                    <a href="#" aria-controls="zero_config" data-dt-idx="0" tabindex="0" class="page-link my-paging">Trước</a>
                                </li>
                                <li class="paginate_button page-item active">
                                    <a href="#" aria-controls="zero_config" data-dt-idx="1" tabindex="0" class="page-link my-paging">1</a>
                                </li>
                                <li class="paginate_button page-item active">
                                    <a href="#" aria-controls="zero_config" data-dt-idx="2" tabindex="0" class="page-link my-paging">2</a>
                                </li>
                                <li class="paginate_button page-item active">
                                    <a href="#" aria-controls="zero_config" data-dt-idx="3" tabindex="0" class="page-link my-paging">3</a>
                                </li>
                                <li class="paginate_button page-item next" id="zero_config_next">
                                    <a href="#" aria-controls="zero_config" data-dt-idx="4" tabindex="0" class="page-link my-paging">Sau</a>
                                </li>
                            </ul>
                        </div>*@
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        //$("#pre-load").show("slow", function () {
        //});
        //$("#pre-load").css("z-index", "99999");
        $('#mainTable')
            //.on('preXhr.dt', function (e, settings, data) {
            //    ////////////////////////////////////HIỆN LÊN MỖI KHI CHẠY AJAX//////////////////////////////////
            //    $("#pre-load").show("slow", function () {
            //    });
            //    $("#pre-load").css("z-index", "99999");
            //    ////////////////////////////////////////////////////////////////////////
            //})
            .DataTable({
                "ajax": {
                    "url": "/cho-tiep-nhan",
                    "type": "POST",
                    "datatype": "json",
                    "data": {
                        "province": function () { return $('#province').val() },
                        "district": function () { return $('#district').val() },
                        "profile": function () { return $('#profile').val() },
                        "dateTo": function () { return $('#dateTo').val() },
                        "dateFrom": function () { return $('#dateFrom').val() },
                        "coQuan": function () { return $('#coQuan').val() },
                    }
                },
                "columns": [
                    { "data": "AppointmentLetterCode", "name": "AppointmentLetterCode" },
                    {
                        "data": "PostalProvinceName", "name": "PostalProvinceName", "render": function (data) {
                            if (data == null) {
                                return $('#province option:selected').html();
                            } else {
                                return data;
                            }
                        }
                    },
                    {
                        "data": "PublicAdministrationName", "name": "PublicAdministrationName", "render": function (data) {
                            if (data == null) {
                                return $('#coQuan option:selected').html();
                            } else {
                                return data;
                            }
                        }
                    },
                    { "data": "ProfileName", "name": "ProfileName" },
                    {
                        "data": "OrderDate", "name": "OrderDate", "render": function (data) {
                            return dateFormat(data);
                        }
                    },
                    { "data": "ReceiverFullName", "name": "ReceiverFullName" },
                    { "data": "ReceiverStreet", "name": "ReceiverStreet" },
                    {
                        "data": "AppointmentLetterCode", "render": function (data) {
                            return "<a class='a-reset' href='ho-so-cho-nhan/chi-tiet?id=" + data + "'><i class='material-icons dp48 edit-icon black-text'>border_color</i></a>";

                        },
                        "orderable": false,
                        "searchable": false,
                    }
                ],
                "drawCallback": function (settings) {
                    ///////////////////////ẨN SAU MỖI AJAX CALL////////////////////////
                    //("#pre-load").hide("slow", function () {
                    //});
                    ////////////////////////////////////////////////
                },
                "serverSide": "true",
                "language": {
                    emptyTable: "<li class='text-danger' align='center'>Không có dữ liệu</li>",
                    paginate:
                    {
                        previous: "Trang trước",
                        next: "Trang sau",
                        first: "|<",
                        last: ">|",

                    },
                    info: "Đang hiện START đến END của TOTAL bản ghi",
                    infoEmpty: "Đang hiện 0 đến 0 của 0 bản ghi",
                },
                "order": [0, "asc"],
                "bLengthChange": false,
                "bFilter": false,
                "bInfo": false,
                "bAutoWidth": false,
                "initComplete": function (settings, json) {
                    ////////////////////////////////////////////////ẨN KHI KHỞI TẠO TABLE XONG  ////////////////////////////////////////////////
                    //$("#pre-load").hide("slow", function () {
                    //});
                    //////////////////////////////////////////////// //////////////////////////////////////////////// ////////////////////////////////////////////////
                }
            });
    });





    function dateFormat(d) {
        if (d == null) {
            return "";
        }
        var dateString = d.substr(6);
        var currentTime = new Date(parseInt(dateString));
        var month = currentTime.getMonth() + 1;
        var day = currentTime.getDate();
        var year = currentTime.getFullYear();
        var date = day + "/" + month + "/" + year;
        return (date);
    }
</script>
<script>
    $(document).ready(function () {
        var dataTable = $('#mainTable').DataTable();
        $("#filter").click(function () {
            dataTable.ajax.reload(function () {
            });
        });
    })
</script>
<script>
        $(document).ready(function () {
            $('#province').change(function () {
                $('#pre-load').show()
                $.ajax({
                    type: "POST",
                    url: "/GetDistrict",
                    cache: false,
                    dataType: 'json',
                    data: {
                        code: $(this).val()
                    },
                    success: function (response) {
                        $('#district').empty();
                        var option = "<option value=''>Tất cả</option>";
                        for (var i = 0; i < response.length; i++) {
                            option += "<option value='" + response[i].PostalDistrictCode + "'>" + response[i].PostalDistrictName + "</option>";
                        }
                        $('#district').append(option);
                        $('#district').formSelect();
                        $('#pre-load').hide()
                    },
                    error: function () {
                        $('#pre-load').hide()
                    }
                })
            })
        })

        $(document).ready(function () {
            $('#district').change(function () {
                $('#pre-load').show()
                $.ajax({
                    type: "POST",
                    url: "/GetAdmins",
                    cache: false,
                    dataType: 'json',
                    data: {
                        code: $(this).val()
                    },
                    success: function (response) {
                        console.log(response)
                        $('#coQuan').empty();
                        var option = "<option value=''>Tất cả</option>";
                        for (var i = 0; i < response.length; i++) {
                            option += "<option value='" + response[i].PublicAdministrationLocationID + "'>" + response[i].PublicAdministrationName + "</option>";
                        }
                        $('#coQuan').append(option);
                        $('#coQuan').formSelect();
                        $('#pre-load').hide()
                    },
                    error: function () {
                        $('#pre-load').hide()
                    }
                })
            })
        })

        $(document).ready(function () {
            $('#coQuan').change(function () {
                $('#pre-load').show()
                $.ajax({
                    type: "POST",
                    url: "/GetProfile",
                    cache: false,
                    dataType: 'json',
                    data: {
                        code: $(this).val()
                    },
                    success: function (response) {
                        console.log(response)
                        $('#profile').empty();
                        var option = "<option value=''>Tất cả</option>";
                        for (var i = 0; i < response.length; i++) {
                            option += "<option value='" + response[i].ProfileID + "'>" + response[i].ProfileName + "</option>";
                        }
                        $('#profile').append(option);
                        $('#profile').formSelect();
                        $('#pre-load').hide()
                    },
                    error: function () {
                        $('#pre-load').hide()
                    }
                })
            })
        })

</script>
<script src="~/CustomJS/datepicker_src/dist/js/datepicker.js"></script>
<script src="~/CustomJS/datepicker_src/dist/js/i18n/datepicker.vi.js"></script>


<script src="~/assets/extra-libs/Datatables/datatables.min.js"></script>
<script src="~/dist/js/pages/datatable/datatable-basic.init.js"></script>